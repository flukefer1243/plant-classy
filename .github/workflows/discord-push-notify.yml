name: Discord Push Notification # This is the name that will appear in the GitHub Actions tab

on:
  push: # This workflow will run whenever code is pushed to the repository
    branches:
      - main # IMPORTANT: Change 'main' to the name of your default branch (e.g., 'master')
      - develop # Add other branches you want to monitor for pushes (e.g., 'staging', 'feature/my-new-feature')
      # If you want it to trigger on *any* branch push, remove the 'branches:' section entirely.

jobs: # Defines the jobs to be run in this workflow
  notify: # This is the name of our single job
    runs-on: ubuntu-latest # Specifies the operating system for the job to run on (GitHub-hosted runner)

    steps: # Defines the sequence of steps within the 'notify' job
      - name: Send Discord notification with embed
        uses: Ilshidur/action-discord@master # This tells GitHub to use a specific action from the marketplace.
                                              # '@master' means use the latest version from the master branch.
                                              # For production, it's often better to use a specific version tag for stability, like:
                                              # uses: Ilshidur/action-discord@0.4.2

        env: # Defines environment variables for this step
          # !!! WARNING: Hardcoding webhook URL is a security risk for public repos.
          # Revert to ${{ secrets.DISCORD_WEBHOOK }} for production/private repos.
          DISCORD_WEBHOOK: "https://discord.com/api/webhooks/1381602440872329256/3jlZKe94gtfGkSkbTYxf7SnK1byyA87r9W2GxYelJ-ioFgHU2XK8Wud6HJiFGPSFjNu4"

        with: # Defines inputs specific to the 'Ilshidur/action-discord' action
          # REMOVE THE PIPE '|' HERE.
          # This tells YAML that the following block is a direct JSON object,
          # not a multi-line string.
          args:
            # The JSON starts here, make sure its indentation aligns with 'args'
            # (or is further indented)
            content: "A new push has occurred!"
            username: "GitHub Actions Notifier"
            avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
            embeds:
              - title: "Code Push Notification"
                description: "Details of the latest push to the repository."
                color: 3066993 # A nice green color (decimal for #2ECC71)
                author:
                  name: "${{ github.actor }}"
                  icon_url: "https://github.com/${{ github.actor }}.png" # Fetch user's GitHub avatar
                fields:
                  - name: "Branch"
                    value: "`${{ github.ref_name }}`"
                    inline: true
                  - name: "Repository"
                    value: "[${{ github.repository }}](${{ github.event.repository.html_url }})"
                    inline: true
                  - name: "Commit Message"
                    value: "```\n${{ github.event.head_commit.message }}\n```"
                    inline: false
                timestamp: "${{ github.event.head_commit.timestamp }}" # Use the commit timestamp
                footer:
                  text: "View changes on GitHub"
                  icon_url: "https://github.githubassets.com/favicons/favicon.png"
                url: "${{ github.event.compare }}" # Make the title clickable to the compare URL